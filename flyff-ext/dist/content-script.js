(()=>{"use strict";function e(e){return"0x"+parseInt(e).toString(16).padStart(8,"0")}class n{constructor(e){this.memory=e}getMemoryType(e){switch(e){case"i8":case"ascii":case"bytes":return Uint8Array;case"i16":case"utf-8":return Uint16Array;case"i32":return Uint32Array;case"i64":return BigInt64Array;case"f32":return Float32Array;case"f64":return Float64Array;default:throw new Error("Invalid memory type "+e+" in getMemoryType()")}}alignedMemory(e){return new(this.getMemoryType(e))(this.memory.buffer)}unalignedMemory(){return new Uint8Array(this.memory.buffer)}getMemorySize(){return this.unalignedMemory().length}search(n,r,t,o){const i={};let s=parseInt(t),c=parseInt(o);s<0&&(s=0);const f=this.getMemorySize();let a;switch(c>=f&&(c=f-1),n){case"ascii":a=new Uint8Array(r.length);for(let e=0;e<r.length;e++)a[e]=r.charCodeAt(e);break;case"utf-8":const e=new Uint16Array(r.length);for(let e=0;e<r.length;e++)a[e]=r.charCodeAt(e);a=new Uint8Array(e.buffer);break;case"bytes":if(Array.isArray(r))a=new Uint8Array(r);else{const e=[...r.trim().matchAll(/\\x[0-9a-f]{2}(?![0-9a-z])/gi)],n=r.trim().split(/\\x/);if(e.length!=n.length-1||0==e.length)return void console.error("Wrong byte sequence format");n.shift(),a=new Uint8Array(n.length);for(let e=0;e<r.length;e++)a[e]=parseInt(n[e],16)}}const u=this.bytesSequence(a);i.results={};for(let n=0;n<u.length;n++){const t=u[n];i.results[t]=r,wyff.logger.info(`${e(t)}: ${r}`)}return i.count=u.length,i}bytesSequence(e){if(wyff.logger.debug("bytesSequence: entering bytes sequence search with parameter "+e),e.length<1)return wyff.logger.error("Minimum length must be at least 1!"),[];e.length<4&&wyff.logger.debug("Sequence length is small: "+e.length+". This will probably return a lot of results!");const n=[],r=this.alignedMemory("i8");let t=0;for(let o=0;o<r.length;o++)r[o]!=e[t]?t==e.length?(n.push(o-e.length),t=0,wyff.logger.debug("bytesSequence: sequence found: "+e)):t=0:t++;return wyff.logger.debug("bytesSequence: exiting bytes sequence search"),n}readBytes(e,n=16,r=8,t=!1){const o=[];let i;8===r?i=new Int8Array(this.memory.buffer):32===r&&(i=new Int32Array(this.memory.buffer));for(let r=0;r<n;r++)o.push(i[e+r]);return t?o.map((e=>String.fromCharCode(e))).join(""):o}}function r(e){return e&&"object"==typeof e&&!Array.isArray(e)}function t(e,...n){if(!n.length)return e;const o=n.shift();if(r(e)&&r(o))for(const n in o)r(o[n])?(e[n]||Object.assign(e,{[n]:{}}),t(e[n],o[n])):Object.assign(e,{[n]:o[n]});return t(e,...n)}function o(e,n){const r=[],t=new BufferReader;n.forEach((e=>{"?"===e?(r.push(t.length),t.copyBuffer([0])):t.copyBuffer(Array.isArray(e)?e:[e])}));const o=new Uint8Array(t.write()),i=new WailParser(e.inBuffer),s=[];if(i.addCodeElementParser(null,(function({index:e,bytes:n}){let t;for(let i=0;i<n.length;i++)if(n[i]===o[0]){let c=!0;t=i;for(let e=1;e<o.length;e++)if(n[i+e]!==o[e]&&!r.includes(e)){c=!1;break}c&&(s.push(e),wyff.logger.debug("Found function using bytes",{bytesToFindView:o,functionIndex:e,matchedBytes:n.subarray(t,t+o.length)}))}return n})),i.parse(),0===s.length)throw wyff.logger.error("Could not find function using bytes",{bytesToFindView:o}),new Error("Could not find function using bytes");if(s.length>1)throw wyff.logger.error("Found multiple functions using bytes",{bytesToFindView:o,matchingFunctionIndexes:s}),new Error("Found multiple functions using bytes");return s[0]}function i(e,n){const r=n-e,t=new Uint8Array(wasmMemory.buffer,e,r),o=new TextDecoder("ascii").decode(t);wyff.logger.debug(`RECEIVED\n%c${t.join("\t")}%c\n%c${o}`,"background: #c4e2ff; color: black;","","background: #c4d0ff; color: black;",{buffer:new Uint8Array(t)})}function s(e){const n=new DataView(e.buffer),r=n.getUint8(17);wyff.logger.info(`movement operation: ${r}`);if(1===r){const e=22,r=n.getFloat32(e,!0);wyff.logger.info(`moving using movement keys: angle: ${r}`)}else if(7===r){const e=n.getFloat32(22,!0),r=n.getFloat32(30,!0),t=n.getFloat32(38,!0);wyff.logger.info(`moving using the mouse: x: ${e}, y: ${r}, z: ${t}`)}wyff.logger.info(`%c${e.slice(4,22)}%c${e.slice(23)}`,"background: orange; color: black;","background: yellow; color: black;")}function c(e){const n=new DataView(wasmMemory.buffer),r=n.getUint32(e,!0),t=n.getUint32(e+4,!0)-r,o=new Uint8Array(new Uint8Array(wasmMemory.buffer,r,t)),i=o.slice(0,4),c=new Uint32Array(i.buffer)[0];let f=c,a=100===i[3];a&&(f=1684713472^c,function(e,n){const r={1028:s};void 0!==r[e]&&r[e](n)}(f,o));const u=new TextDecoder("ascii").decode(o);wyff.logger.debug(`SENDING (cmd: ${f} (${a?"E":"NE"}))\n%c${o.join("\t")}%c\n%c${u}`,"background: #c4ffcd; color: black;","","background: #a7facd; color: black;",{buffer:o})}function f(e,n,r,t){return e.addImportEntry({moduleStr:"env",fieldStr:n,kind:"func",type:e.addTypeEntry({form:"func",params:r,returnType:t})})}function a(e){return async function(n,r={}){wyff.logger.debug("WebAssembly.instantiate() intercepted");const s=function(e){const n=new WailParser(e),r={env:{encryptionHook:c,decryptionHook:i}},t=f(n,"encryptionHook",["i32"]),s=f(n,"decryptionHook",["i32","i32"]);try{!function(e,n){const r=o(e,[OP_GET_LOCAL,VarUint32(0),OP_I32_LOAD,VarUint32(2),VarUint32(4),OP_TEE_LOCAL,VarUint32(2),OP_GET_LOCAL,VarUint32(0),OP_I32_LOAD,VarUint32(2),VarUint32(0),OP_TEE_LOCAL,VarUint32(3),OP_I32_SUB,OP_SET_LOCAL,VarUint32(6),OP_I32_CONST,9,OP_SET_LOCAL,VarUint32(7)]);wyff.logger.info("Found encryption function",{functionIndex:r}),e.addCodeElementParser(e._getAdjustedFunctionIndex(r),(function({bytes:e}){const r=new BufferReader(e);return r.copyBuffer([OP_GET_LOCAL]),r.copyBuffer(VarUint32(0)),r.copyBuffer([OP_CALL]),r.copyBuffer(n.varUint32()),r.copyBuffer(e),r.write()}))}(n,t)}catch(e){wyff.logger.error("error hooking encryption function"),wyff.logger.error(e)}try{!function(e,n){const r=o(e,[OP_GET_LOCAL,VarUint32(2),OP_I32_LOAD,VarUint32(2),VarUint32(36),OP_I32_LOAD,0,VarUint32(5)]);wyff.logger.info("Found decryption function",{functionIndex:r}),e.addCodeElementParser(e._getAdjustedFunctionIndex(r),(function({bytes:e}){const r=new BufferReader(e);return r.copyBuffer(e.subarray(0,e.length-1)),r.copyBuffer([OP_GET_LOCAL]),r.copyBuffer(VarUint32(0)),r.copyBuffer([OP_GET_LOCAL]),r.copyBuffer(VarUint32(1)),r.copyBuffer([OP_CALL]),r.copyBuffer(n.varUint32()),r.copyBuffer([OP_END]),r.write()}))}(n,s)}catch(e){wyff.logger.error("error hooking decryption function"),wyff.logger.error(e)}return n.parse(),function(e,n){return{imports:e,binary:n}}(r,n.write())}(n);return s.imports&&(r=t(r,s.imports)),e(s.binary,r)}}async function u(){if(sourceObj instanceof Promise)return(await sourceObj).arrayBuffer();if(sourceObj instanceof Response)return await sourceObj.arrayBuffer();throw new Error("Got unexpected object type as first argument to WebAssembly.instantiateStreaming")}const g=new class{constructor(e,n,r){this.infoWriter=e||console.log,this.debugWriter=n||console.debug,this.errorWriter=r||console.error;const t=["font-size: 1.6em","font-weight: bold","text-transform: uppercase"].join(";");this.info=this.infoWriter.bind(console,"%c[WYFF]%c INFO\t%s",t,""),this.debug=this.debugWriter.bind(console,"%c[WYFF]%c DEBUG\t%s",t,""),this.error=this.errorWriter.bind(console,"%c[WYFF]%c ERROR\t%s",t,"")}};window.wyff={logger:g},setInterval((()=>{void 0!==window.wasmMemory&&(window.MemoryWrapper=new n(wasmMemory))})),wyff.logger.debug("hooking function to remove debugger protection"),window._Function=Function,window.Function=function(){window.c=e=>e?()=>()=>{}:null,wyff.logger.debug("debugger protection removed");const e=window._Function.apply(this,arguments);return window.Function=window._Function,e},wyff.logger.info("hooking WASM functions"),function(){const e=a(WebAssembly.instantiate);window.WebAssembly.instantiate=e}(),WebAssembly.instantiateStreaming,window.WebAssembly.instantiateStreaming=async function(e,n={}){wyff.logger.debug("WebAssembly.instantiateStreaming() intercepted");const r=await u();return WebAssembly.instantiate(r,n)}})();
//# sourceMappingURL=content-script.js.map