{"version":3,"file":"injected-script.js","mappings":"mBAAAA,eAAeC,IACX,GAAIC,qBAAqBC,QAErB,aADkBD,WACPE,cACR,GAAIF,qBAAqBG,SAC5B,aAAaH,UAAUE,cAEvB,MAAM,IAAIE,MAAM,mFAExB,CCNA,MAAMC,EAAS,ICHA,MACX,WAAAC,CAAYC,EAAYC,EAAaC,GACjCC,KAAKH,WAAaA,GAAcI,QAAQC,IACxCF,KAAKF,YAAcA,GAAeG,QAAQE,MAC1CH,KAAKD,YAAcA,GAAeE,QAAQG,MAE1C,MAAMC,EAAc,CAChB,mBACA,oBACA,6BACFC,KAAK,KAEPN,KAAKO,KAAOP,KAAKH,WAAWW,KAAKP,QAAS,sBAAuBI,EAAa,IAC9EL,KAAKG,MAAQH,KAAKF,YAAYU,KAAKP,QAAS,uBAAwBI,EAAa,IACjFL,KAAKI,MAAQJ,KAAKD,YAAYS,KAAKP,QAAS,uBAAwBI,EAAa,GACrF,GDZmBI,OAAOC,KAAMD,OAAOE,OAAQF,OAAOG,QAC1DH,OAAOI,KAAO,CACVlB,UEDAkB,KAAKlB,OAAOY,KAAK,0BCON,WACX,MACMO,GAXkBC,EAUJC,YAAYC,YATzB7B,eAAe8B,EAAcC,EAAe,CAAC,GAChDN,KAAKlB,OAAOY,KAAK,yCAEjB,MAAMa,ECNC,SAA0BC,GACrC,MAAMC,EAAS,IAAIC,WAAWF,GAa9B,OAXAC,EAAOE,qBAAqB,MAAM,UAAU,MAAEC,IAC1C,MAAMC,EAAe,CACjBC,aAAcC,UAAU,GACxBC,YAAaD,UAAU,GAAOA,UAAU,IAI5C,OAFAf,KAAKlB,OAAOY,KAAKmB,GACjBb,KAAKlB,OAAOY,KAAKkB,GACVA,CACX,IAEAH,EAAOQ,QACAR,EAAOS,OAClB,CDTkCC,CAAiBd,GAC3C,OAAOH,EAASK,EAAmBD,EACvC,GANJ,IAA4BJ,EAYxBN,OAAOO,YAAYC,YAAcH,CACrC,CDVImB,GHeoBjB,YAAYkB,qBAEhCzB,OAAOO,YAAYkB,qBAVZ9C,eAAeE,EAAW6B,EAAe,CAAC,GAC7CN,KAAKlB,OAAOY,KAAK,kDACjB,MAAM4B,QAAe9C,IACrB,OAAO2B,YAAYC,YAAYkB,EAAQhB,EAC3C,C","sources":["webpack:///./src/injected-script/wasm-trigger/instantiateStreaming.js","webpack:///./src/injected-script/index.js","webpack:///./src/shared/utils/log.js","webpack:///./src/injected-script/wasm-trigger/index.js","webpack:///./src/injected-script/wasm-trigger/instantiate.js","webpack:///./src/injected-script/wasm-hooks/index.js"],"sourcesContent":["async function getSourceBuffer() {\n    if (sourceObj instanceof Promise) {\n        const res = await sourceObj;\n        return res.arrayBuffer()\n    } else if (sourceObj instanceof Response) {\n        return await sourceObj.arrayBuffer();\n    } else {\n        throw new Error(\"Got unexpected object type as first argument to WebAssembly.instantiateStreaming\");\n    }\n}\n\nfunction createHookFunction(original) {\n    return async function(sourceObj, importObject = {}) {\n        wyff.logger.info(\"WebAssembly.instantiateStreaming() intercepted\");\n        const buffer = await getSourceBuffer(sourceObj);\n        return WebAssembly.instantiate(buffer, importObject);\n    };\n}\n\nexport default function hookInstantiateStreaming() {\n    const oldFunction = WebAssembly.instantiateStreaming;\n    const hook = createHookFunction(oldFunction);\n    window.WebAssembly.instantiateStreaming = hook;\n}\n","import Log from \"../shared/utils/log.js\";\nimport hookWASMTriggerFunctions from \"./wasm-trigger/index.js\";\n\nconst logger = new Log(window._log, window._debug, window._error);\nwindow.wyff = {\n    logger,\n};\n\nhookWASMTriggerFunctions();","export default class Log {\n    constructor(infoWriter, debugWriter, errorWriter) {\n        this.infoWriter = infoWriter || console.log;\n        this.debugWriter = debugWriter || console.debug;\n        this.errorWriter = errorWriter || console.error;\n\n        const prefixStyle = [\n            \"font-size: 1.6em\",\n            \"font-weight: bold\",\n            \"text-transform: uppercase\",\n        ].join(\";\");\n\n        this.info = this.infoWriter.bind(console, \"%c[WYFF]%c INFO\\t%s\", prefixStyle, \"\");\n        this.debug = this.debugWriter.bind(console, \"%c[WYFF]%c DEBUG\\t%s\", prefixStyle, \"\");\n        this.error = this.errorWriter.bind(console, \"%c[WYFF]%c ERROR\\t%s\", prefixStyle, \"\");\n    }\n}\n","import hookInstantiate from \"./instantiate.js\";\nimport hookInstantiateStreaming from \"./instantiateStreaming.js\";\n\nexport default function hookWASMTriggerFunctions() {\n    wyff.logger.info(`hooking WASM functions`);\n    hookInstantiate();\n    hookInstantiateStreaming();\n}","import instrumentBinary from \"../wasm-hooks\";\n\nfunction createHookFunction(original) {\n    return async function(bufferSource, importObject = {}) {\n        wyff.logger.info(\"WebAssembly.instantiate() intercepted\");\n\n        const instrumentResults = instrumentBinary(bufferSource);\n        return original(instrumentResults, importObject);\n    };\n}\n\nexport default function hookInstantiate() {\n    const oldFunction = WebAssembly.instantiate;\n    const hook = createHookFunction(oldFunction);\n    window.WebAssembly.instantiate = hook;\n}\n","export default function instrumentBinary(binary) {\n    const parser = new WailParser(binary);\n\n    parser.addCodeElementParser(2655, function ({ bytes }) {\n        const byteSequence = [\n            OP_GET_LOCAL, VarUint32(0x00),\n            OP_I32_LOAD, VarUint32(0x00), VarUint32(0x04),\n        ];\n        wyff.logger.info(byteSequence);\n        wyff.logger.info(bytes);\n        return bytes;\n    });\n\n    parser.parse();\n    return parser.write();\n}"],"names":["async","getSourceBuffer","sourceObj","Promise","arrayBuffer","Response","Error","logger","constructor","infoWriter","debugWriter","errorWriter","this","console","log","debug","error","prefixStyle","join","info","bind","window","_log","_debug","_error","wyff","hook","original","WebAssembly","instantiate","bufferSource","importObject","instrumentResults","binary","parser","WailParser","addCodeElementParser","bytes","byteSequence","OP_GET_LOCAL","VarUint32","OP_I32_LOAD","parse","write","instrumentBinary","hookInstantiate","instantiateStreaming","buffer"],"sourceRoot":""}